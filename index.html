<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generator QR – MECARD</title>
  <!-- QRCode.js (bez integrity, prosto z cdnjs) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f8fafc;color:#0f172a}
    .wrap{max-width:1000px;margin:0 auto;padding:24px}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px}
    .grid{display:grid;gap:16px}
    @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}
    label{display:block;font-size:13px;color:#475569;margin-bottom:4px}
    input,select,textarea{width:100%;box-sizing:border-box;border:1px solid #e2e8f0;border-radius:12px;padding:10px;font-size:14px;outline:none}
    button{border:1px solid #0f172a;border-radius:12px;padding:10px 14px;background:#0f172a;color:#fff;cursor:pointer}
    button[disabled]{opacity:.5;cursor:not-allowed}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    #qrcode{display:flex;align-items:center;justify-content:center;min-height:260px;border:1px dashed #e2e8f0;border-radius:12px}
    .hint{font-size:12px;color:#64748b}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px">Generator QR (MECARD)</h1>
    <p class="hint" style="margin:0 0 16px">Wpisz dane i wygeneruj kod QR działający na iOS i Androidzie. Jeśli nie widzisz QR, wciśnij <b>Ctrl/Cmd+Shift+R</b> (twarde odświeżenie).</p>

    <div class="grid">
      <section class="card">
        <div class="grid">
          <div>
            <label>Imię *</label>
            <input id="firstName" placeholder="Michał">
          </div>
          <div>
            <label>Nazwisko *</label>
            <input id="lastName" placeholder="Okoń">
          </div>

          <div class="grid" style="grid-template-columns:1fr 1fr">
            <div>
              <label>Telefon</label>
              <input id="phone" placeholder="+48600123456">
            </div>
            <div>
              <label>E-mail</label>
              <input id="email" placeholder="kontakt@twojadomena.pl">
            </div>
          </div>

          <div>
            <label>Firma</label>
            <input id="org" placeholder="TS Invest">
          </div>
          <div>
            <label>Stanowisko</label>
            <input id="title" placeholder="UX/UI Designer">
          </div>
          <div>
            <label>Strona www</label>
            <input id="url" placeholder="https://twojadomena.pl">
          </div>

          <div class="row" style="margin-top:6px">
            <button id="genBtn">Generuj QR</button>
            <button id="dlBtn" disabled>Pobierz PNG</button>
            <button id="copyBtn" disabled>Kopiuj MECARD</button>
          </div>
         <!-- <p class="hint">W MECARD znaki <code>\ ; : ,</code> są automatycznie „ucieczone”.</p>-->
          <div id="err" class="hint" style="color:#b91c1c;display:none"></div>
        </div>
      </section>

      <section class="card">
        <h3 style="margin:0 0 10px">Podgląd</h3>
        <div id="qrcode"></div>

        <div style="margin-top:12px">
          <label>Wynikowy MECARD</label>
          <textarea id="mecardOut" class="mono" rows="4" readonly></textarea>
        </div>

        <div style="margin-top:12px" class="grid" >
          <div>
            <label>Rozmiar QR</label>
            <select id="qrSize">
              <option>256</option>
              <option selected>320</option>
              <option>384</option>
              <option>448</option>
            </select>
          </div>
          <div>
            <label>Korekcja błędów</label>
            <select id="qrEcc">
              <option value="L">L</option>
              <option value="M" selected>M</option>
              <option value="Q">Q</option>
              <option value="H">H</option>
            </select>
          </div>
        </div>
        <!--<p class="hint" style="margin-top:6px">Do wizytówki zwykle wystarczy 20–25 mm i ECC M/Q (zostaw „quiet zone”).</p>-->
      </section>
    </div>
  </div>

  <script>
    // Zaczekaj aż biblioteka się załaduje (defer+DOMContentLoaded)
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof QRCode === 'undefined') {
        const err = document.getElementById('err');
        err.style.display = 'block';
        err.textContent = 'Błąd: biblioteka QRCode.js się nie załadowała. Sprawdź blokady (uBlock/NoScript) lub odśwież stronę twardo (Ctrl/Cmd+Shift+R).';
        return;
      }

      // Escapowanie wg MECARD
      function esc(v=""){return v.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/:/g,"\\:").replace(/,/g,"\\,").trim()}
      function normPhone(v=""){return v.replace(/[^\d+;]/g,"")}
      function buildMECARD(f){
        const pts=[];
        const ln=esc(f.lastName), fn=esc(f.firstName);
        if (ln||fn) pts.push(`N:${ln}${ln&&fn?",":""}${fn}`);
        if (f.org)   pts.push(`ORG:${esc(f.org)}`);
        if (f.title) pts.push(`TITLE:${esc(f.title)}`);
        const tel=normPhone(f.phone); if (tel) pts.push(`TEL:${tel}`);
        if (f.email) pts.push(`EMAIL:${esc(f.email)}`);
        if (f.url)   pts.push(`URL:${esc(f.url)}`);
        return `MECARD:${pts.join(";")};;`;
      }

      const eccMap={L:QRCode.CorrectLevel.L,M:QRCode.CorrectLevel.M,Q:QRCode.CorrectLevel.Q,H:QRCode.CorrectLevel.H};
      const qrcodeEl=document.getElementById('qrcode');
      const out=document.getElementById('mecardOut');
      const genBtn=document.getElementById('genBtn');
      const dlBtn=document.getElementById('dlBtn');
      const copyBtn=document.getElementById('copyBtn');
      let qr=null;

      function gen(){
        const f={
          firstName:document.getElementById('firstName').value,
          lastName: document.getElementById('lastName').value,
          phone:    document.getElementById('phone').value,
          email:    document.getElementById('email').value,
          org:      document.getElementById('org').value,
          title:    document.getElementById('title').value,
          url:      document.getElementById('url').value
        };
        if(!f.firstName||!f.lastName){alert('Podaj co najmniej imię i nazwisko.');return;}
        const mecard=buildMECARD(f);
        out.value=mecard;

        const size=parseInt(document.getElementById('qrSize').value,10)||320;
        const ecc=eccMap[document.getElementById('qrEcc').value]||QRCode.CorrectLevel.M;

        qrcodeEl.innerHTML="";
        qr=new QRCode(qrcodeEl,{text:mecard,width:size,height:size,correctLevel:ecc});
        dlBtn.disabled=false; copyBtn.disabled=false;
      }

      function downloadPNG(){
        if(!qr) return;
        const canvas=qrcodeEl.querySelector('canvas');
        const img=qrcodeEl.querySelector('img');
        const link=document.createElement('a'); link.download='mecard-qr.png';
        if(canvas){ link.href=canvas.toDataURL('image/png'); link.click(); return; }
        if(img && img.src){ link.href=img.src; link.click(); }
      }

      async function copyMECARD(){
        try{ await navigator.clipboard.writeText(out.value); copyBtn.textContent='Skopiowano ✔'; setTimeout(()=>copyBtn.textContent='Kopiuj MECARD',1200);}
        catch{ alert('Nie udało się skopiować do schowka.'); }
      }

      genBtn.addEventListener('click', gen);
      dlBtn.addEventListener('click', downloadPNG);
      copyBtn.addEventListener('click', copyMECARD);

      // Starter values (możesz usunąć)
      document.getElementById('firstName').value='Imię';
      document.getElementById('lastName').value='Nazwisko';
      document.getElementById('org').value='Twoja firma';
      document.getElementById('title').value='Twoje stanowisko';
      document.getElementById('phone').value='+48600123456';
      document.getElementById('email').value='kontakt@twojadomena.pl';
      document.getElementById('url').value='https://twojadomena.pl';
    });
  </script>
</body>
</html>


